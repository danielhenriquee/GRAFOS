<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interface Gráfica para Grafos</title>
    <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Plus+Jakarta+Sans:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        /* Variáveis CSS globais  */
        :root {
            /* Cores */
            --bg-color: #fff5f8;              /* Fundo rosa bem clarinho */
            --panel-color: #ffffff;           /* Painéis brancos */
            --text-color: #705d62;            /* Texto em tom de marrom rosado escuro */
            --text-secondary-color: #ad9a9f;  /* Texto mais claro para rótulos */
            --accent-color: #fec5d9;           /* Rosa suave como cor de destaque */
            --accent-hover: #fa9cb7;           /* Rosa um pouco mais forte para hover */
            --border-color: #ffe0e9;          /* Cor de borda rosada */
            --button-secondary-bg: #ffeef2;
            --button-secondary-text: #8b7379;
            --button-secondary-hover-bg: #fddde6;
            
            /* Fontes */
            --main-font: 'Plus Jakarta Sans', sans-serif;
            --title-font: 'Playfair Display', serif; /* fonte para os títulos */
        }

        /* Estilização do corpo da página (<body>) */
        body {
            font-family: var(--main-font);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0.8em;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 0.8em;
            height: calc(100vh - 1.6em);
        }

        /* Estilo para os painéis principais */
        .panel {
            background-color: var(--panel-color);
            padding: 1.5em;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 0.8em; 
        }

        .controls { overflow-y: auto; }
        .output { overflow: hidden; }

        /* Estilo para os títulos (<h2>) */
        h2 {
            margin: 0;
            color: var(--text-color);
            font-family: var(--title-font); /* Aplica a nova fonte de título */
            border-bottom: 2px dotted var(--accent-color); /* Linha pontilhada delicada */
            padding-bottom: 0.3em;
            font-weight: 600;
            font-size: 1.3rem;
        }

        /* Estilo para os grupos de formulário */
        .form-group { 
            display: flex; 
            flex-direction: column; 
            gap: 1em; 
        }
        
        /* Estilo para os campos de entrada de texto e botões */
        input[type="number"], textarea {
            background-color: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.7em;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 0.95rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        /* Efeito visual para quando o usuário clica em um campo de texto */
        input[type="number"]:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(254, 197, 217, 0.5); /* Sombra rosa suave */
        }

        /* Estilo para o grupo de botões de operações */
        .button-group { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 12px;
        }

        /* Estilo para os botões */
        button {
            background-color: var(--accent-color);
            color: #fff;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.1);
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-family: var(--main-font);
            font-size: 0.95rem;
            font-weight: 600;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        button:hover { 
            background-color: var(--accent-hover); 
            transform: translateY(-2px);
        }
        
        /* Estilo para o botão secundário ("Desenhar Grafo") */
        button.secondary { 
            background-color: var(--button-secondary-bg); 
            color: var(--button-secondary-text);
            text-shadow: none;
        }
        button.secondary:hover { background-color: var(--button-secondary-hover-bg); }
        
        /* Layout para o painel da direita (saída) */
        .output {
            display: grid;
            grid-template-rows: auto 1fr auto auto;
        }

        /* Estilo para a "caixinha do grafo" */
        #cy {
            width: 100%;
            height: 100%; 
            min-height: 200px;
            background-color: var(--panel-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            grid-row: 2;
        }

        /* Estilo para a "caixinha de saída de texto" */
        #output-pre {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            padding: 1em;
            white-space: pre-wrap;
            border-radius: 8px;
            height: 90px;
            overflow-y: auto; 
            font-size: 0.85rem;
            grid-row: 4;
        }

        /* Estilos para o modal de aviso */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(112, 93, 98, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal-overlay:not(.hidden) {
            opacity: 1;
            pointer-events: all;
        }

        .modal-box {
            background-color: var(--panel-color);
            padding: 2em;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 400px;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay:not(.hidden) .modal-box {
            transform: scale(1);
        }

        #aviso-mensagem {
            margin: 0 0 1.5em 0;
            font-size: 1rem;
            color: var(--text-color);
            white-space: pre-wrap;
        }
    </style>
</head>
<body>

    <div class="panel controls">
        <div class="form-group">
            <h2>Configuração</h2>
            <label for="num-vertices">Número de Vértices</label>
            <input type="number" id="num-vertices" value="5" min="1" max="100">
        </div>
        <div class="form-group">
            <label><input type="checkbox" id="is-directed"> Grafo Direcionado</label>
        </div>
        <div class="form-group">
            <label for="edges-input">Arestas (formato 'u v', uma por linha)</label>
            <textarea id="edges-input" rows="8">1 2
1 5
2 3
2 4
2 5
3 4
4 5</textarea>
            <div class="draw-color-group">
                <button class="secondary" onclick="updateGraphDisplay()">Desenhar Grafo</button>
                <button onclick="runCommand('colorir')">Colorir Grafo</button>
            </div>
        </div>
        
        <div class="form-group">
            <h2>Operações</h2>
            <label for="start-vertex">Vértice Inicial (1 a N)</label>
            <input type="number" id="start-vertex" value="1" min="1">
            <div class="button-group">
                <button onclick="runCommand('dfs')">DFS</button>
                <button onclick="runCommand('bfs')">BFS</button>
                <button onclick="runCommand('ftd')">FTD</button>
                <button onclick="runCommand('fti')">FTI</button>
                <button onclick="runCommand('conectividade')" style="grid-column: span 2;">Verificar Conectividade</button>
            </div>
        </div>
    </div>

    <div class="panel output">
        <h2>Visualização do Grafo</h2>
        <div id="cy"></div>
        <h2>Saída do Programa</h2>
        <pre id="output-pre">A saída do programa aparecerá aqui...</pre>
    </div>

    <div id="aviso-modal" class="modal-overlay hidden">
        <div class="modal-box">
            <p id="aviso-mensagem"></p>
            <button id="aviso-fechar">Fechar</button>
        </div>
    </div>

    <script>
        // --- 1. SELEÇÃO DOS ELEMENTOS HTML ---
        // Guarda referências aos elementos HTML em variáveis para usá-las facilmente no código.
        const numVerticesInput = document.getElementById('num-vertices');
        const isDirectedCheckbox = document.getElementById('is-directed');
        const edgesTextarea = document.getElementById('edges-input');
        const startVertexInput = document.getElementById('start-vertex');
        const outputPre = document.getElementById('output-pre');

        // Seleção dos elementos do novo modal de aviso
        const modal = document.getElementById('aviso-modal');
        const mensagemP = document.getElementById('aviso-mensagem');
        const botaoFechar = document.getElementById('aviso-fechar');

        // --- 2. LÓGICA DO MODAL DE AVISO ---
        /**
         * Mostra o modal de aviso com uma mensagem específica.
         * @param {string} mensagem O texto a ser exibido no aviso.
         */
        function mostrarAviso(mensagem) {
            mensagemP.innerText = `AVISO:\n\n${mensagem}`; // Adiciona o texto ao modal
            modal.classList.remove('hidden'); // Mostra o modal
        }

        /**
         * Esconde o modal de aviso.
         */
        function fecharAviso() {
            modal.classList.add('hidden'); // Esconde o modal
        }

        botaoFechar.addEventListener('click', fecharAviso); // Fecha ao clicar no botão "Fechar"
        modal.addEventListener('click', (event) => {
            // Fecha também se o usuário clicar no fundo esmaecido (fora da caixa de aviso)
            if (event.target === modal) {
                fecharAviso();
            }
        });

        // --- 3. VARIÁVEIS GLOBAIS DO GRAFO ---
        let cy; // Variável para guardar a instância do grafo
        const colorPalette = [ // Paleta de cores para a função de coloração
            '#e6194B', '#3cb44b', '#ffe119', '#4363d8', '#f58231', 
            '#911eb4', '#42d4f4', '#f032e6', '#bfef45', '#fabed4', 
            '#469990', '#dcbeff', '#9A6324', '#fffac8', '#800000'
        ];

        // --- 4. FUNÇÕES PRINCIPAIS DO GRAFO ---

        /**
         * Função para desenhar o grafo na tela usando a biblioteca Cytoscape.
         * @param {Array} nodes - Um array com os vértices (nós) do grafo.
         * @param {Array} edges - Um array com as arestas do grafo.
         * @param {boolean} isDirected - Se o grafo é direcionado ou não.
         */
        function plotGraph(nodes, edges, isDirected) {
            cy = cytoscape({
                container: document.getElementById('cy'),
                elements: { nodes: nodes, edges: edges },
                style: [
                    {
                        selector: 'node',
                        style: {
                            'background-color': '#c5a7b0',
                            'label': 'data(id)',
                            'color': '#ffffff',
                            'font-family': 'var(--main-font)',
                            'font-weight': '600',
                            'text-valign': 'center',
                            'text-halign': 'center'
                        }
                    },
                    {
                        selector: 'edge',
                        style: {
                            'width': 2.5,
                            'line-color': '#e6d1d8',
                            'target-arrow-color': '#e6d1d8',
                            'target-arrow-shape': isDirected ? 'triangle' : 'none',
                            'curve-style': 'bezier'
                        }
                    }
                ],
                layout: { name: 'cose', animate: false, padding: 10 }
            });
        }

        /**
         * Lê os dados dos campos de formulário e os converte em formatos úteis.
         * Retorna um objeto com dados para o C++ e para o Cytoscape.
         */
        function parseGraphData() {
            const numVertices = parseInt(numVerticesInput.value);
            const isDirected = isDirectedCheckbox.checked;
            const edgesText = edgesTextarea.value.trim();

            let cyNodes = [];
            for (let i = 1; i <= numVertices; i++) {
                cyNodes.push({ data: { id: i.toString() } });
            }

            let matrix = Array(numVertices).fill(0).map(() => Array(numVertices).fill(0));
            let cyEdges = [];
            
            if (isNaN(numVertices) || numVertices <= 0) return { error: 'O número de vértices deve ser maior que 0.' };

            if(edgesText) {
                const lines = edgesText.split('\n');
                for (const line of lines) {
                    if (!line.trim()) continue;
                    
                    const parts = line.trim().split(/\s+/);
                    if (parts.length !== 2) return { error: `Formato de aresta inválido: "${line}"\nUse o formato 'u v'.` };
                    
                    const u = parseInt(parts[0]);
                    const v = parseInt(parts[1]);

                    if (isNaN(u) || isNaN(v) || u < 1 || u > numVertices || v < 1 || v > numVertices) {
                        return { error: `Vértice inválido na aresta "${u} ${v}".\nOs vértices devem estar entre 1 e ${numVertices}.` };
                    }
                    
                    matrix[u - 1][v - 1] = 1;
                    if (!isDirected) matrix[v - 1][u - 1] = 1;

                    cyEdges.push({ data: { id: `${u}-${v}`, source: u.toString(), target: v.toString() } });
                }
            }
            
            return { numVertices, isDirected, matrix, cyNodes, cyEdges, error: null };
        }
        
        /**
         * Função chamada pelo botão "Desenhar Grafo".
         */
        function updateGraphDisplay() {
            const { cyNodes, cyEdges, isDirected, error } = parseGraphData();
            if (error) {
                // Chama o novo aviso personalizado em caso de erro.
                mostrarAviso(error);
                return;
            }
            plotGraph(cyNodes, cyEdges, isDirected);
            outputPre.textContent = 'Grafo desenhado. Escolha uma operação.';
        }

        /**
         * Função principal chamada por todos os botões de operação.
         * @param {string} command - O comando a ser executado (ex: 'dfs', 'colorir').
         */
        async function runCommand(command) {
            const { numVertices, isDirected, matrix, cyNodes, cyEdges, error } = parseGraphData();
            if (error) {
                mostrarAviso(error);
                return;
            }

            if (command === 'dfs' || command === 'bfs' || command === 'ftd' || command === 'fti') {
                const startVertex = parseInt(startVertexInput.value);
                if (isNaN(startVertex)) {
                    mostrarAviso('O Vértice Inicial deve ser um número.');
                    return;
                }
                if (startVertex < 1 || startVertex > numVertices) {
                    mostrarAviso(`O Vértice Inicial deve estar entre 1 e ${numVertices}.`);
                    return;
                }
            }

            outputPre.textContent = 'Executando...';
            plotGraph(cyNodes, cyEdges, isDirected);

            const payload = {
                command: command,
                numVertices: numVertices,
                isDirected: isDirected,
                matrix: matrix,
                startVertex: parseInt(startVertexInput.value) - 1
            };
            
            try {
                const response = await fetch('/run', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                });
                const result = await response.json();
                outputPre.textContent = result.error || result.output;

                if (command === 'colorir' && result.colors && cy) {
                    result.colors.forEach((color, index) => {
                        const vertexId = index + 1;
                        const colorHex = colorPalette[color - 1] || '#888888';
                        cy.getElementById(vertexId.toString()).style('background-color', colorHex);
                    });
                }

            } catch (err) {
                outputPre.textContent = 'Erro de comunicação com o servidor. Verifique se o `server.py` está rodando.';
            }
        }

        // --- 5. INICIALIZAÇÃO ---
        // Desenha o grafo inicial assim que a página é carregada.
        window.addEventListener('load', updateGraphDisplay);
    </script>
</body>
</html>